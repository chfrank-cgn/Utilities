@version: 3.17
@include "scl.conf"

# Syslog-ng configuration file, compatible with default Debian syslogd
# installation.

# First, set some global options.
options { chain_hostnames(off); use_dns(no); use_fqdn(no); dns_cache(no);
	owner("root"); group("adm"); perm(0644); stats_freq(0);
	bad_hostname("^gconfd$");
};

########################
# Sources
########################
# This is the default behavior of sysklogd package
# Logs may come from unix stream, but not from another machine.
#
source s_netudp {
	syslog(ip("0.0.0.0") transport("udp"));
};

source s_nettcp {
	syslog(ip("0.0.0.0") transport("tcp"));
};

source s_internal {
		internal();
};

########################
# Destinations
########################
# First some standard logfile
#
destination d_file {
		file("/var/log/cluster.${HOUR12}.log"
			flags(no-multi-line)
        	overwrite-if-older(6000));
};

destination d_redis {
		redis(host("35.224.100.126")
			port(6379)
			auth("syslog-ng")
			command("HINCRBY" "${HOST}/programs" "${PROGRAM}" "1"));
};

########################
# Log paths
########################
#
log { source(s_nettcp); source(s_netudp); source(s_internal); destination(d_file); destination(d_redis); };

###
# Include all config files in /etc/syslog-ng/conf.d/
###
@include "/etc/syslog-ng/conf.d/*.conf"
